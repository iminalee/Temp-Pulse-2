<!DOCTYPE html>

<html lang="ko"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>ë©˜íƒˆ ë±…í¬ (The Mental Bank) - ì ì¬ì˜ì‹ ì¬ì„¤ê³„ ì‹œìŠ¤í…œ</title> <script src="https://cdn.tailwindcss.com"></script> <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet"> <style> body { font-family: 'Noto Sans KR', sans-serif; background-color: #f0fdf4; /* Light green tint for prosperity / } / Chart Container Styling as per requirements / .chart-container { position: relative; width: 100%; max-width: 800px; / Controlled max width / margin-left: auto; margin-right: auto; height: 40vh; / Responsive height / max-height: 400px; overflow: hidden; / Prevent overflow / } @media (min-width: 768px) { .chart-container { height: 400px; } } .handwriting-font { font-family: 'Courier New', Courier, monospace; / Fallback for a script-like feel */ font-style: italic; } .tab-active { border-bottom: 2px solid #15803d; color: #15803d; font-weight: bold; } .tab-inactive { color: #64748b; } .hidden-section { display: none; } </style> </head> <body class="text-slate-800">

<!-- Main Application Container -->
<div class="min-h-screen flex flex-col">
    
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-5xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <span class="text-2xl">ğŸ¦</span>
                <h1 class="text-xl font-bold text-slate-800 tracking-tight">ë©˜íƒˆ ë±…í¬ <span class="text-xs font-normal text-slate-500">Subconscious Ledger</span></h1>
            </div>
            <div class="text-right">
                <p class="text-xs text-slate-500 uppercase">í˜„ì¬ ë©˜íƒˆ ì”ì•¡</p>
                <p class="text-2xl font-bold text-green-700" id="header-balance">â‚©0</p>
            </div>
        </div>
        <!-- Navigation -->
        <nav class="max-w-5xl mx-auto px-4 mt-2">
            <div class="flex space-x-6 overflow-x-auto">
                <button onclick="switchTab('dashboard')" id="tab-dashboard" class="pb-3 px-1 tab-active whitespace-nowrap transition-colors">ëŒ€ì‹œë³´ë“œ</button>
                <button onclick="switchTab('contract')" id="tab-contract" class="pb-3 px-1 tab-inactive whitespace-nowrap transition-colors">ê³„ì•½ ë° ì„¤ì •</button>
                <button onclick="switchTab('ledger')" id="tab-ledger" class="pb-3 px-1 tab-inactive whitespace-nowrap transition-colors">ì¼ì¼ ì¥ë¶€ (Ledger)</button>
                <button onclick="switchTab('guide')" id="tab-guide" class="pb-3 px-1 tab-inactive whitespace-nowrap transition-colors">ì›ë¦¬ ë° ê°€ì´ë“œ</button>
            </div>
        </nav>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow bg-slate-50 p-4">
        <div class="max-w-5xl mx-auto space-y-6">

            <!-- SECTION 1: DASHBOARD -->
            <section id="section-dashboard">
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h2 class="text-lg font-bold mb-2 text-slate-800">ë‚˜ì˜ ìŠ¤í¬ë¦½íŠ¸ ì§„í–‰ í˜„í™©</h2>
                    <p class="text-sm text-slate-600 mb-4">
                        ì´ ëŒ€ì‹œë³´ë“œëŠ” ë‹¹ì‹ ì˜ <strong>ì ì¬ì˜ì‹ ì•ˆë½ì§€ëŒ€(Comfort Zone)</strong>ê°€ í™•ì¥ë˜ëŠ” ê³¼ì •ì„ ì‹œê°í™”í•©ë‹ˆë‹¤. 
                        ë©˜íƒˆ ë±…í¬ ì´ë¡ ì— ë”°ë¥´ë©´, ë‹¹ì‹ ì˜ ë©˜íƒˆ ì”ì•¡ì´ ëª©í‘œì¹˜ì— ë„ë‹¬í•  ë•Œ í˜„ì‹¤ì˜ ìˆ˜ì…ê³¼ ì„±ê³µë„ ê·¸ ìˆ˜ì¤€ì— ë§ì¶° ë”°ë¼ì˜¤ê²Œ ë©ë‹ˆë‹¤. 
                        ì§€ê·¸ì¬ê·¸ íŒ¨í„´(í˜„ì‹¤ì˜ ë“±ë½)ì„ ë„˜ì–´ ê¾¸ì¤€íˆ ìš°ìƒí–¥í•˜ëŠ” ë©˜íƒˆ ì”ì•¡ì„ í™•ì¸í•˜ì„¸ìš”.
                    </p>
                    
                    <!-- Chart -->
                    <div class="w-full bg-slate-50 rounded-xl p-2 border border-slate-100 mb-4">
                        <div class="chart-container">
                            <canvas id="mentalBankChart"></canvas>
                        </div>
                    </div>

                    <!-- Key Stats -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
                        <div class="p-4 bg-green-50 rounded-lg border border-green-100">
                            <p class="text-xs text-green-600 mb-1">ë©˜íƒˆ ë±…í¬ ëª©í‘œ (ì—°ìˆ˜ì… x2)</p>
                            <p class="text-lg font-bold" id="dash-goal">â‚©0</p>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-lg border border-blue-100">
                            <p class="text-xs text-blue-600 mb-1">ì‹œê°„ë‹¹ ìˆ˜ë‹¹</p>
                            <p class="text-lg font-bold" id="dash-rate">â‚©0</p>
                        </div>
                        <div class="p-4 bg-purple-50 rounded-lg border border-purple-100">
                            <p class="text-xs text-purple-600 mb-1">ëª©í‘œ ë‹¬ì„±ë¥ </p>
                            <p class="text-lg font-bold" id="dash-progress">0%</p>
                        </div>
                        <div class="p-4 bg-orange-50 rounded-lg border border-orange-100">
                            <p class="text-xs text-orange-600 mb-1">ìµœê·¼ í•´í”„ë‹</p>
                            <p class="text-sm font-medium truncate" id="dash-happening">-</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION 2: CONTRACT (SETUP) -->
            <section id="section-contract" class="hidden-section">
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-bold mb-2 text-slate-800">ìƒˆë¡œìš´ ë©˜íƒˆ ìŠ¤í¬ë¦½íŠ¸ ê³„ì•½</h2>
                    <p class="text-sm text-slate-600 mb-6">
                        ì„±ê³µì€ ìš°ì—°ì´ ì•„ë‹™ë‹ˆë‹¤. ë©˜íƒˆ ë±…í¬ì˜ ì²« ë‹¨ê³„ëŠ” í˜„ì¬ì˜ ì—° ìˆ˜ì…ì„ ê¸°ì¤€ìœ¼ë¡œ <strong>2ë°°ì˜ ëª©í‘œ</strong>ë¥¼ ì„¤ì •í•˜ê³ , 
                        ì´ë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•œ ë‚˜ì˜ ì‹œê°„ë‹¹ ê°€ì¹˜ë¥¼ ì¬ì‚°ì •í•˜ëŠ” ê³„ì•½ì„ ìŠ¤ìŠ¤ë¡œì™€ ì²´ê²°í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. 
                        ì´ê³³ì—ì„œ ì„¤ì •í•œ ê°’ì€ ì¥ë¶€ ê¸°ë¡ì˜ ê¸°ì¤€ì´ ë©ë‹ˆë‹¤.
                    </p>

                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- Income Setup -->
                        <div class="space-y-4">
                            <label class="block">
                                <span class="text-sm font-medium text-slate-700">í˜„ì¬ ì—° ìˆ˜ì… (A)</span>
                                <input type="number" id="input-current-income" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-green-500 outline-none transition" placeholder="ì˜ˆ: 50000000">
                            </label>
                            
                            <div class="p-4 bg-slate-100 rounded-lg space-y-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-600">ë©˜íƒˆ ë±…í¬ ëª©í‘œ (A x 2)</span>
                                    <span class="font-bold text-green-700" id="calc-goal">â‚©0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-600">ì‹œê°„ë‹¹ ìˆ˜ë‹¹ (ëª©í‘œ / 1000)</span>
                                    <span class="font-bold text-blue-700" id="calc-rate">â‚©0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-600">ë©˜íƒˆ ë±…í¬ ì”ì•¡ ëª©í‘œ (ëª©í‘œ x 4)</span>
                                    <span class="font-bold text-slate-700" id="calc-target">â‚©0</span>
                                </div>
                            </div>
                            <button onclick="saveContract()" class="w-full bg-slate-800 text-white py-3 rounded-lg hover:bg-slate-700 transition shadow-lg">ê³„ì•½ ì €ì¥ ë° ê°±ì‹ </button>
                        </div>

                        <!-- Value Events Setup -->
                        <div class="space-y-4 border-t md:border-t-0 md:border-l border-slate-200 pt-6 md:pt-0 md:pl-6">
                            <h3 class="font-bold text-slate-700 flex justify-between">
                                <span>ë°¸ë¥˜ ì´ë²¤íŠ¸ (Value Events)</span>
                                <span class="text-xs font-normal text-slate-500 bg-slate-100 px-2 py-1 rounded">ì„±ê³µ, í–‰ë³µ, í’ìš”</span>
                            </h3>
                            <p class="text-xs text-slate-500">ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ ìˆ˜í–‰í•  ê¸ì •ì ì¸ í™œë™ì„ ì •ì˜í•©ë‹ˆë‹¤. (ê¸°ë³¸ê°’ ì œê³µ)</p>
                            
                            <ul id="value-event-list" class="space-y-2 max-h-64 overflow-y-auto">
                                <!-- Populated by JS -->
                            </ul>
                            
                            <div class="flex space-x-2">
                                <input type="text" id="new-event-name" placeholder="ìƒˆë¡œìš´ í™œë™ (ì˜ˆ: ë…ì„œ)" class="flex-grow p-2 rounded border border-slate-300 text-sm">
                                <button onclick="addValueEvent()" class="bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700">ì¶”ê°€</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION 3: LEDGER (DAILY ENTRY) -->
            <section id="section-ledger" class="hidden-section">
                <div class="bg-white rounded-lg shadow p-6 border-l-4 border-green-500">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-lg font-bold text-slate-800">ì¼ì¼ ë©˜íƒˆ ì¥ë¶€ (Ledger)</h2>
                            <p class="text-xs text-slate-500">ìê¸° ì „ 30ë¶„, 'ë§ˆë²•ì˜ ì‹œê°„'ì— ê¸°ë¡í•˜ì„¸ìš”.</p>
                        </div>
                        <div class="text-right">
                            <span class="block text-xs text-slate-400">ì˜¤ëŠ˜ì˜ ë‚ ì§œ</span>
                            <input type="date" id="ledger-date" class="text-sm font-bold bg-transparent border-none text-right focus:ring-0 cursor-pointer">
                        </div>
                    </div>

                    <p class="text-sm text-slate-600 mb-6 bg-green-50 p-3 rounded">
                        ğŸ’¡ <strong>íŒ:</strong> ì†ê¸€ì”¨ëŠ” ë¹„íŒì  ì‚¬ê³ ë¥¼ ìš°íšŒí•˜ì—¬ ì ì¬ì˜ì‹ì— ì§ì ‘ ë‹¿ìŠµë‹ˆë‹¤. ì´ ë””ì§€í„¸ ë„êµ¬ëŠ” ê¸°ë¡ì„ ë³´ê´€í•˜ì§€ë§Œ, ë§ˆìŒì†ìœ¼ë¡œëŠ” íœìœ¼ë¡œ ê¾¹ê¾¹ ëˆŒëŸ¬ ì“°ëŠ” ìƒìƒì„ í•˜ë©° ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.
                    </p>

                    <!-- Entry Form -->
                    <div class="space-y-6">
                        
                        <!-- Value Events Selection -->
                        <div>
                            <h3 class="text-sm font-bold text-slate-700 mb-2">ì˜¤ëŠ˜ ìˆ˜í–‰í•œ ë°¸ë¥˜ ì´ë²¤íŠ¸</h3>
                            <div id="ledger-event-inputs" class="space-y-3">
                                <!-- Dynamic Inputs Here -->
                            </div>
                        </div>

                        <!-- Happenings & Affirmations -->
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">í•´í”„ë‹ (Happenings)</label>
                                <textarea id="input-happenings" class="w-full h-24 p-3 rounded-md border border-slate-300 text-sm handwriting-font placeholder-slate-400" placeholder="ì˜¤ëŠ˜ ì¼ì–´ë‚œ ê¸ì •ì ì¸ ì¼ì´ë‚˜ ìš°ì—°ì„ ê¸°ë¡í•˜ì„¸ìš”."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">í™•ì–¸ ë° íˆ¬ì (Affirmations)</label>
                                <textarea id="input-affirmations" class="w-full h-24 p-3 rounded-md border border-slate-300 text-sm handwriting-font placeholder-slate-400" placeholder="ë‚˜ëŠ” ë¶€ìê°€ ë  ê¸°íšŒë¥¼ ì¡ì„ ì¤€ë¹„ê°€ ë˜ì–´ ìˆë‹¤."></textarea>
                            </div>
                        </div>

                        <!-- Calculation Display -->
                        <div class="border-t border-dashed border-slate-300 pt-4 flex justify-between items-end">
                            <div>
                                <p class="text-xs text-slate-500">ì˜¤ëŠ˜ì˜ ì ë¦½ì•¡</p>
                                <p class="text-2xl font-bold text-green-600" id="daily-total-display">â‚©0</p>
                            </div>
                            <button onclick="submitLedger()" class="bg-slate-900 text-white px-8 py-3 rounded-lg hover:bg-slate-800 transition transform active:scale-95 font-bold shadow-lg">
                                ì¥ë¶€ ê¸°ë¡í•˜ê¸° âœï¸
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Recent History -->
                <div class="mt-8">
                    <h3 class="text-md font-bold text-slate-700 mb-3">ìµœê·¼ ê¸°ë¡ ë‚´ì—­</h3>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="min-w-full text-sm text-left">
                            <thead class="bg-slate-50 text-slate-500 font-medium">
                                <tr>
                                    <th class="px-4 py-3">ë‚ ì§œ</th>
                                    <th class="px-4 py-3">í™œë™</th>
                                    <th class="px-4 py-3 text-right">ì ë¦½ì•¡</th>
                                    <th class="px-4 py-3 text-right">ëˆ„ì  ì”ì•¡</th>
                                </tr>
                            </thead>
                            <tbody id="ledger-history-body" class="divide-y divide-slate-100">
                                <!-- History Rows -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- SECTION 4: GUIDE (THEORY) -->
            <section id="section-guide" class="hidden-section">
                <div class="bg-white rounded-lg shadow p-8 space-y-8">
                    <div class="border-b border-slate-100 pb-4">
                        <h2 class="text-2xl font-bold text-slate-800 mb-2">ë©˜íƒˆ ë±…í¬ì˜ 5ê°€ì§€ ì„±ê³µ ìš”ë¦¬ë²•</h2>
                        <p class="text-slate-500">ì¡´ ì¹´íŒŒìŠ¤(John Kappas) ë°•ì‚¬ì˜ ì´ë¡ ì— ê¸°ë°˜í•œ ì ì¬ì˜ì‹ í”„ë¡œê·¸ë˜ë°</p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <h3 class="font-bold text-green-700">1. ë¯¿ìŒ (Belief)</h3>
                            <p class="text-sm text-slate-600 leading-relaxed">
                                ìš°ë¦¬ì˜ í˜„ì¬ ìƒí™©ì€ ì ì¬ì˜ì‹ ì† 'ìŠ¤í¬ë¦½íŠ¸'ì˜ ê²°ê³¼ì…ë‹ˆë‹¤. ë§Œì¡±ìŠ¤ëŸ½ì§€ ì•Šë‹¤ë©´ ë” ì¢‹ì€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒˆë¡œ ì¨ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.
                            </p>
                        </div>
                        <div class="space-y-2">
                            <h3 class="font-bold text-green-700">2. ë§¤ì¼ì˜ ê°•í™” (Daily Reinforcement)</h3>
                            <p class="text-sm text-slate-600 leading-relaxed">
                                ê¸ì •ì  ì‚¬ê³ ëŠ” ì˜ì‹ì˜ 12%ì— ë¶ˆê³¼í•©ë‹ˆë‹¤. ë©˜íƒˆ ë±…í¬ëŠ” ë‚˜ë¨¸ì§€ 88%ì˜ ë¬´ì˜ì‹ì— ë§¤ì¼ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì—¬ ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤.
                            </p>
                        </div>
                        <div class="space-y-2">
                            <h3 class="font-bold text-green-700">3. ìŠ¤í¬ë¦½íŒ… (Scripting)</h3>
                            <p class="text-sm text-slate-600 leading-relaxed">
                                ì†ê¸€ì”¨ëŠ” 'ì´ë””ì˜¤ëª¨í„°(Ideomotor)' ë°˜ì‘ì„ ì¼ìœ¼ì¼œ ë¹„íŒì  ì‚¬ê³ (Critical Area)ë¥¼ ìš°íšŒí•˜ê³  ì ì¬ì˜ì‹ì— ì§ì ‘ ë„ë‹¬í•©ë‹ˆë‹¤.
                            </p>
                        </div>
                        <div class="space-y-2">
                            <h3 class="font-bold text-green-700">4. íƒ€ì´ë° & ê¿ˆ (Timing & Dreams)</h3>
                            <p class="text-sm text-slate-600 leading-relaxed">
                                ìê¸° ì „ 30ë¶„ì€ ì˜ì‹ì´ ê³¼ë¶€í•˜ë˜ì–´ ìì—°ìŠ¤ëŸ¬ìš´ ìµœë©´ ìƒíƒœê°€ ë˜ëŠ” 'ë§ˆë²•ì˜ ì‹œê°„'ì…ë‹ˆë‹¤. ì´ë•Œ ì…ë ¥ëœ ì •ë³´ëŠ” ê¿ˆì˜ 'ì˜ˆì§€ ë‹¨ê³„(Precognitive Stage)'ë¡œ ë“¤ì–´ê°€ ë¯¸ë˜ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤.
                            </p>
                        </div>
                    </div>

                    <div class="bg-slate-50 p-4 rounded-lg border-l-4 border-orange-400">
                        <h3 class="font-bold text-slate-800 mb-1">ì•ˆë½ì§€ëŒ€(Comfort Zone)ì™€ ì €í•­</h3>
                        <p class="text-sm text-slate-600">
                            ì ì¬ì˜ì‹ì€ 'Known(ìµìˆ™í•¨)'ì„ ì¦ê±°ì›€ìœ¼ë¡œ, 'Unknown(ë‚¯ì„¦)'ì„ ê³ í†µìœ¼ë¡œ ì¸ì‹í•©ë‹ˆë‹¤. 
                            ìˆ˜ì…ì´ ê°‘ìê¸° ëŠ˜ë©´ ë¬´ì˜ì‹ì€ ì´ë¥¼ ë¶ˆí¸í•˜ê²Œ ì—¬ê²¨ ë‹¤ì‹œ ì›ë˜ëŒ€ë¡œ ë˜ëŒë¦¬ë ¤ í•©ë‹ˆë‹¤(Sabotage).
                            ë©˜íƒˆ ë±…í¬ëŠ” ê°€ìƒì˜ ê³ ì†Œë“ ê²½í—˜ì„ í†µí•´ <strong>ì•ˆë½ì§€ëŒ€ì˜ ìƒí•œì„ ì„ ë†’ì—¬</strong>, 
                            ì‹¤ì œ ì„±ê³µì´ ë‹¤ê°€ì™”ì„ ë•Œ ì´ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ë°›ì•„ë“¤ì´ë„ë¡ ë§Œë“­ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </section>

        </div>
    </main>
</div>

<!-- JavaScript Logic -->
<script>
    // --- State Management ---
    const DEFAULT_EVENTS = [
        "ì¼ê¸° ì“°ê¸°", "ìš´ë™", "ê±´ê°• ì‹ë‹¨", "ë…ì„œ/ìê¸°ê³„ë°œ", 
        "ì—…ë¬´/ì§ì¥ ì¼", "ê°€ì¡±ê³¼ì˜ ì‹œê°„", "ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ êµ¬ìƒ"
    ];

    let appState = {
        currentIncome: 30000000,
        mbGoal: 60000000, // Income * 2
        hourlyRate: 60000, // Goal / 1000
        balance: 0,
        valueEvents: [...DEFAULT_EVENTS],
        history: []
    };

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        // Set today's date
        document.getElementById('ledger-date').valueAsDate = new Date();
        
        // Initial Calculations
        recalcContract(appState.currentIncome);
        
        // Render UI
        renderValueEventsConfig();
        renderLedgerInputs();
        initChart();
        updateDashboard();
    });

    // --- Navigation Logic ---
    function switchTab(tabName) {
        // Hide all sections
        document.querySelectorAll('section').forEach(el => el.classList.add('hidden-section'));
        // Show selected
        document.getElementById(`section-${tabName}`).classList.remove('hidden-section');
        
        // Update Tab Styles
        document.querySelectorAll('nav button').forEach(btn => {
            btn.className = "pb-3 px-1 tab-inactive whitespace-nowrap transition-colors";
        });
        document.getElementById(`tab-${tabName}`).className = "pb-3 px-1 tab-active whitespace-nowrap transition-colors";

        // Refresh Chart if dashboard
        if(tabName === 'dashboard') {
            updateChart();
        }
    }

    // --- Contract Logic ---
    const inputIncome = document.getElementById('input-current-income');
    
    inputIncome.addEventListener('input', (e) => {
        const val = parseInt(e.target.value) || 0;
        recalcContract(val);
    });

    function recalcContract(income) {
        appState.currentIncome = income;
        // Rule: Goal is 2x current income (or 4x if high earner, simplifying to 2x for base logic)
        appState.mbGoal = income * 2;
        // Rule: Hourly Rate is Goal / 1000
        appState.hourlyRate = appState.mbGoal / 1000;

        // Update UI Displays
        document.getElementById('calc-goal').innerText = formatCurrency(appState.mbGoal);
        document.getElementById('calc-rate').innerText = formatCurrency(appState.hourlyRate);
        document.getElementById('calc-target').innerText = formatCurrency(appState.mbGoal * 4);
    }

    function saveContract() {
        // Reset Ledger inputs based on new rate
        renderLedgerInputs();
        updateDashboard();
        alert("ê³„ì•½ì´ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ì‹œê°„ë‹¹ ìˆ˜ë‹¹ì´ ì ìš©ë©ë‹ˆë‹¤.");
        switchTab('ledger');
    }

    function renderValueEventsConfig() {
        const list = document.getElementById('value-event-list');
        list.innerHTML = '';
        appState.valueEvents.forEach((event, index) => {
            const li = document.createElement('li');
            li.className = "flex justify-between items-center bg-slate-50 p-2 rounded border border-slate-200";
            li.innerHTML = `
                <span class="text-sm text-slate-700">${event}</span>
                <button onclick="removeValueEvent(${index})" class="text-red-400 hover:text-red-600 text-xs">ì‚­ì œ</button>
            `;
            list.appendChild(li);
        });
    }

    function addValueEvent() {
        const input = document.getElementById('new-event-name');
        const val = input.value.trim();
        if (val) {
            appState.valueEvents.push(val);
            renderValueEventsConfig();
            renderLedgerInputs();
            input.value = '';
        }
    }

    function removeValueEvent(index) {
        appState.valueEvents.splice(index, 1);
        renderValueEventsConfig();
        renderLedgerInputs();
    }

    // --- Ledger Logic ---
    function renderLedgerInputs() {
        const container = document.getElementById('ledger-event-inputs');
        container.innerHTML = '';

        appState.valueEvents.forEach((event, index) => {
            const div = document.createElement('div');
            div.className = "flex items-center justify-between p-3 bg-white border border-slate-200 rounded-lg hover:border-green-300 transition-colors";
            div.innerHTML = `
                <div class="flex items-center space-x-3">
                    <input type="checkbox" id="check-${index}" class="w-5 h-5 text-green-600 rounded focus:ring-green-500" onchange="calcDailyTotal()">
                    <label for="check-${index}" class="text-sm font-medium text-slate-700 select-none">${event}</label>
                </div>
                <div class="flex items-center space-x-2">
                    <input type="number" id="hours-${index}" value="1" min="0.5" step="0.5" class="w-16 p-1 text-right text-sm border rounded" onchange="calcDailyTotal()">
                    <span class="text-xs text-slate-500">ì‹œê°„</span>
                    <label class="flex items-center space-x-1 cursor-pointer" title="ë³´ë„ˆìŠ¤ ì´ë²¤íŠ¸ëŠ” 2ë°° ì§€ê¸‰">
                        <input type="checkbox" id="bonus-${index}" class="text-orange-500 rounded" onchange="calcDailyTotal()">
                        <span class="text-[10px] text-orange-600 font-bold">BONUS</span>
                    </label>
                </div>
            `;
            container.appendChild(div);
        });
    }

    function calcDailyTotal() {
        let total = 0;
        appState.valueEvents.forEach((_, index) => {
            const checked = document.getElementById(`check-${index}`).checked;
            if (checked) {
                const hours = parseFloat(document.getElementById(`hours-${index}`).value) || 0;
                const isBonus = document.getElementById(`bonus-${index}`).checked;
                const multiplier = isBonus ? 2 : 1;
                total += (appState.hourlyRate * hours * multiplier);
            }
        });
        document.getElementById('daily-total-display').innerText = formatCurrency(total);
        return total;
    }

    function submitLedger() {
        const total = calcDailyTotal();
        if (total <= 0) {
            alert("ìˆ˜í–‰í•œ ë°¸ë¥˜ ì´ë²¤íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
        }

        const date = document.getElementById('ledger-date').value;
        const happening = document.getElementById('input-happenings').value;
        const affirmation = document.getElementById('input-affirmations').value;

        // Logic: Add to balance
        const previousBalance = appState.balance;
        appState.balance += total;

        // Record History
        const entry = {
            date: date,
            total: total,
            balance: appState.balance,
            happening: happening
        };
        appState.history.push(entry);

        // Update UI
        updateDashboard();
        updateHistoryTable();
        
        // Clear inputs
        document.querySelectorAll('#ledger-event-inputs input[type="checkbox"]').forEach(el => el.checked = false);
        document.getElementById('input-happenings').value = '';
        document.getElementById('input-affirmations').value = '';
        document.getElementById('daily-total-display').innerText = formatCurrency(0);

        // Feedback
        alert(`ğŸ‰ ì¥ë¶€ ê¸°ë¡ ì™„ë£Œ!\n\nì˜¤ëŠ˜ì˜ ì ë¦½ì•¡: ${formatCurrency(total)}\ní˜„ì¬ ì´ ì”ì•¡: ${formatCurrency(appState.balance)}`);
        switchTab('dashboard');
    }

    function updateHistoryTable() {
        const tbody = document.getElementById('ledger-history-body');
        tbody.innerHTML = '';
        // Show last 5 entries
        [...appState.history].reverse().slice(0, 5).forEach(entry => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="px-4 py-3 whitespace-nowrap text-slate-600">${entry.date}</td>
                <td class="px-4 py-3 text-slate-600 truncate max-w-[150px]">${entry.happening || 'í™œë™ ê¸°ë¡'}</td>
                <td class="px-4 py-3 text-right font-medium text-green-600">+${formatCurrency(entry.total)}</td>
                <td class="px-4 py-3 text-right font-bold text-slate-700">${formatCurrency(entry.balance)}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    function updateDashboard() {
        document.getElementById('header-balance').innerText = formatCurrency(appState.balance);
        document.getElementById('dash-goal').innerText = formatCurrency(appState.mbGoal);
        document.getElementById('dash-rate').innerText = formatCurrency(appState.hourlyRate);
        
        // Progress Calculation
        const targetBalance = appState.mbGoal * 4;
        const percent = targetBalance > 0 ? Math.min(100, (appState.balance / targetBalance) * 100).toFixed(1) : 0;
        document.getElementById('dash-progress').innerText = `${percent}%`;

        // Last happening
        const lastEntry = appState.history[appState.history.length - 1];
        document.getElementById('dash-happening').innerText = lastEntry && lastEntry.happening ? lastEntry.happening : "ì•„ì§ ê¸°ë¡ ì—†ìŒ";

        updateChart();
    }

    // --- Chart Logic ---
    let chartInstance = null;

    function initChart() {
        const ctx = document.getElementById('mentalBankChart').getContext('2d');
        
        // Initial Dummy Data to show the "Concept"
        const labels = ['ì‹œì‘', '1ì£¼ì°¨', '2ì£¼ì°¨', '3ì£¼ì°¨', '4ì£¼ì°¨', 'ëª©í‘œ'];
        
        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'ë©˜íƒˆ ë±…í¬ ì”ì•¡ (Mental Balance)',
                        data: [0, null, null, null, null, null], // Starts at 0
                        borderColor: '#15803d', // Green
                        backgroundColor: 'rgba(21, 128, 61, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'í˜„ì‹¤ ì•ˆë½ì§€ëŒ€ (Current Comfort Zone)',
                        data: [null, null, null, null, null, null], // Dynamic
                        borderColor: '#94a3b8', // Slate
                        borderDash: [5, 5],
                        borderWidth: 2,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'â‚©' + value.toLocaleString();
                            }
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': â‚©' + context.raw.toLocaleString();
                            }
                        }
                    }
                }
            }
        });
    }

    function updateChart() {
        if(!chartInstance) return;

        // Prepare data from history
        const historyLabels = appState.history.map(h => h.date);
        const historyData = appState.history.map(h => h.balance);

        // If no history, keep dummy view, else show real
        if (appState.history.length > 0) {
            chartInstance.data.labels = historyLabels;
            chartInstance.data.datasets[0].data = historyData;

            // The Comfort Zone Line (The ceiling we are breaking)
            // This simulates the zig-zag ceiling described in the PDF
            const comfortZone = appState.currentIncome; 
            chartInstance.data.datasets[1].data = new Array(historyLabels.length).fill(comfortZone);
        } else {
            // Show projected path if empty
             chartInstance.data.datasets[1].data = [appState.currentIncome, appState.currentIncome, appState.currentIncome, appState.currentIncome, appState.currentIncome, appState.currentIncome];
        }

        chartInstance.update();
    }

    // --- Helpers ---
    function formatCurrency(num) {
        return 'â‚©' + Math.floor(num).toLocaleString();
    }
</script>
<!-- [ADD ON] Contract Modal Component -->
<!-- ì´ ì½”ë“œë¥¼ </body> íƒœê·¸ ë°”ë¡œ ìœ„ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš” -->

<style>
    /* ê³„ì•½ì„œ ëª¨ë‹¬ ì „ìš© ìŠ¤íƒ€ì¼ */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(2, 6, 23, 0.95); /* ì•„ì£¼ ì§„í•œ ë°°ê²½ */
        backdrop-filter: blur(8px);
        z-index: 9999;
        display: flex; justify-content: center; align-items: center;
        opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
    }
    .modal-overlay.active { opacity: 1; pointer-events: all; }

    .contract-paper {
        background: #0f172a;
        width: 100%; max-width: 600px; height: 85vh;
        border: 1px solid #22d3ee;
        border-radius: 8px;
        box-shadow: 0 0 50px rgba(34, 211, 238, 0.15);
        position: relative;
        display: flex; flex-direction: column;
        overflow: hidden;
        transform: scale(0.95); transition: transform 0.3s ease;
    }
    .modal-overlay.active .contract-paper { transform: scale(1); }

    .contract-header {
        padding: 20px; border-bottom: 1px solid #1e293b;
        display: flex; justify-content: space-between; align-items: center;
        background: rgba(34, 211, 238, 0.05);
    }
    .contract-body {
        padding: 30px; overflow-y: auto; color: #94a3b8;
        font-family: 'Noto Sans KR', sans-serif; font-size: 14px; line-height: 1.8;
    }
    .contract-footer {
        padding: 20px; border-top: 1px solid #1e293b;
        text-align: center; background: #0f172a;
    }

    .article-title { color: #22d3ee; font-weight: bold; margin-top: 20px; margin-bottom: 8px; display: block; }
    .highlight-money { color: #fff; background: rgba(34, 211, 238, 0.1); padding: 2px 6px; border-radius: 4px; font-weight: bold; }
    
    /* ë‘¥ë‘¥ ë– ë‹¤ë‹ˆëŠ” í”Œë¡œíŒ… ë²„íŠ¼ */
    .floating-btn {
        position: fixed; bottom: 30px; right: 30px;
        background: #0f172a; border: 1px solid #22d3ee;
        color: #22d3ee; padding: 12px 20px;
        border-radius: 50px; cursor: pointer;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        z-index: 1000; font-size: 12px; font-weight: bold;
        display: flex; align-items: center; gap: 8px;
        transition: all 0.3s;
    }
    .floating-btn:hover { background: #22d3ee; color: #000; transform: translateY(-3px); }
</style>

<!-- í”Œë¡œíŒ… ë²„íŠ¼ (í™”ë©´ ìš°ì¸¡ í•˜ë‹¨ ê³ ì •) -->
<button class="floating-btn" onclick="openContract()">
    <i class="fa-solid fa-file-contract"></i> ì¡´ì¬ ê³„ì•½ì„œ í™•ì¸
</button>

<!-- ëª¨ë‹¬ ë³¸ë¬¸ -->
<div id="contractModal" class="modal-overlay">
    <div class="contract-paper">
        <!-- í—¤ë” -->
        <div class="contract-header">
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-scale-balanced text-cyan-400"></i>
                <span class="text-white font-bold text-sm tracking-widest uppercase">The Bond of Essential Identity</span>
            </div>
            <button onclick="closeContract()" class="text-slate-500 hover:text-white transition"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>

        <!-- ë‚´ìš© (ìŠ¤í¬ë¡¤ ì˜ì—­) -->
        <div class="contract-body text-justify">
            <h2 class="text-2xl text-white font-bold text-center mb-2">ì¡´ì¬ì  ê³„ì•½ (å­˜åœ¨çš„ å¥‘ç´„)</h2>
            <p class="text-xs text-center text-slate-500 mb-8 tracking-[0.2em]">VER.0 â†” APEX BP MERGER AGREEMENT</p>

            <span class="article-title">Article 01. ìê²© ê²€ì¦ ë° ì„ íƒ</span>
            í˜„ì¡´ ìì•„(Ver.0)ê°€ ê°ˆë§í•˜ëŠ” ëª¨ë“  ì„±ì·¨ë¥¼ ì´ë¯¸ ì™„ìˆ˜í•˜ì—¬ ì ì¬ë ¥ì„ 100% ê°œí™”ì‹œí‚¨ ì™„ì„±ì²´, ë§ˆìŠ¤í„° ìì•„ <strong>Apex BP</strong>ëŠ”, ë¬´í•œí•œ í‰í–‰ì„¸ê³„ ì¤‘ ë³¸ ì°¨ì›ì˜ ëŒ€ë¦¬ì¸ì¸ ê·€í•˜ê°€ ë³´ìœ í•œ ê³ ìœ í•œ Pulse(ê¸°ì§ˆì  ì§„ë™)ê°€ Apex BPì™€ ê°€ì¥ ë†’ì€ ì¼ì¹˜ìœ¨ì„ ë³´ì„ì„ í™•ì¸í•˜ì˜€ë‹¤. ì´ì— Apex BPëŠ” í˜„ì¡´ ìì•„ë¥¼ ìì‹ ì˜ ìœ ì¼í•œ í˜„ì‹¤ íŒŒíŠ¸ë„ˆë¡œ ì„ íƒí•˜ê³  <strong>'ì¡´ì¬ì  ìƒì¥(Existential IPO)'</strong>ì„ ìŠ¹ì¸í•œë‹¤.

            <span class="article-title">Article 02. í•©ì¹˜ì˜ ëª©ì </span>
            ë³¸ ê³„ì•½ì˜ ëª©ì ì€ ë‚´ë©´ì˜ ì”¨ì•—ì„ ë°œí™”ì‹œì¼œ, í˜„ì¡´ ì„¸ê³„ë¥¼ Apex BPê°€ ì‹¤ì¡´í•˜ëŠ” ê³ ì°¨ì› í‰í–‰ì„¸ê³„ì™€ ì™„ì „íˆ <strong>í•©ì¹˜(Merging)</strong>ì‹œí‚¤ëŠ” ë° ìˆë‹¤.

            <span class="article-title">Article 03. ë™ê¸°í™” í”„ë¡œí† ì½œ</span>
            <ul class="list-disc pl-5 space-y-1 mt-2">
                <li><strong>ì¼ê°„ ì‹¤í–‰ (Day):</strong> ë‚® ì‹œê°„ ë™ì•ˆ ver.0ëŠ” Apex BPì˜ ìƒê°ê³¼ í’ˆì„±ì„ ì±„íƒí•˜ì—¬ í–‰ë™í•œë‹¤.</li>
                <li><strong>ì•¼ê°„ ì ‘ì† (Night):</strong> ì·¨ì¹¨ ì „, í•˜ë£¨ì˜ ê°ê°ì„ ë³µê¸°í•˜ë©° ë¯¸ë˜ ì°¨ì›ê³¼ ì ‘ì†í•œë‹¤.</li>
            </ul>

            <span class="article-title">Article 04. ì—ë„ˆì§€ ìì› í• ë‹¹ (Rewards)</span>
            Apex BPëŠ” ë¬´ì˜ì‹ ì›ì¥ì¸ Mental Bank Balanceì˜ 25%ì— í•´ë‹¹í•˜ëŠ” ê¸ˆì•¡ì¸ <span class="highlight-money">â‚©280,000,000</span>ë¥¼ í™œë™ ì—ë„ˆì§€ë¡œ ì¦‰ì‹œ ë¶€ì—¬í•œë‹¤. ì´ ì—ë„ˆì§€ëŠ” í˜„ì‹¤ì˜ ë§ˆì°°ë ¥ì„ ìƒì‡„í•˜ëŠ” ê°•ë ¥í•œ ì¶”ì§„ë ¥ì´ ëœë‹¤.

            <span class="article-title">Article 05. ë¯¸ì…˜ ë° ë³´ìƒ</span>
            ì‹¤í–‰ ë°€ë„ê°€ ë†’ì•„ì§ˆìˆ˜ë¡ ì‹œê°„ë‹¹ ê°€ì¹˜ ë³´ìƒ <span class="highlight-money">â‚©560,000</span>ì€ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ì¦í­ë˜ë©°, ë°œìƒí•œ ëª¨ë“  ë³´ìƒì€ Mental Bankì— ì¦‰ì‹œ ì˜ˆì¹˜ë˜ì–´ ë‘ ìì•„ ì‚¬ì´ì˜ ë™ê¸°í™” ì†ë„ë¥¼ ê°€ì†í•œë‹¤.
            
            <div class="mt-8 pt-8 border-t border-slate-800 text-center">
                <p class="text-xs mb-4">ìœ„ ë‚´ìš©ì„ í™•ì¸í•˜ì˜€ìœ¼ë©°, ì´ì— ì–‘ìëŠ” ì„œëª…í•œë‹¤.</p>
                <div class="flex justify-between px-8 font-serif text-white">
                    <span>Apex BP : <em>(Signed)</em></span>
                    <span>Ver.0 : <span id="user-sign-area" class="text-slate-500 border-b border-slate-600 pb-1 w-24 inline-block">________________</span></span>
                </div>
            </div>
        </div>

        <!-- í‘¸í„° (ì„œëª… ë²„íŠ¼) -->
        <div class="contract-footer">
            <button id="btn-sign" onclick="signContract()" class="w-full bg-cyan-500 hover:bg-cyan-400 text-slate-950 font-bold py-3 rounded-lg transition-all shadow-[0_0_20px_rgba(34,211,238,0.3)]">
                ê³„ì•½ ì²´ê²° ë° ì—ë„ˆì§€ ìˆ˜ë ¹í•˜ê¸°
            </button>
        </div>
    </div>
</div>

<script>
    function openContract() {
        document.getElementById('contractModal').classList.add('active');
        document.body.style.overflow = 'hidden'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë§‰ê¸°
    }

    function closeContract() {
        document.getElementById('contractModal').classList.remove('active');
        document.body.style.overflow = '';
    }

    function signContract() {
        const btn = document.getElementById('btn-sign');
        const signArea = document.getElementById('user-sign-area');
        
        // ì„œëª… íš¨ê³¼
        signArea.innerText = "( Signed )";
        signArea.style.color = "#22d3ee";
        signArea.style.fontStyle = "italic";
        
        btn.innerHTML = `<i class="fa-solid fa-check"></i> ê³„ì•½ ì²´ê²° ì™„ë£Œ`;
        btn.classList.replace('bg-cyan-500', 'bg-slate-700');
        btn.classList.replace('text-slate-950', 'text-white');
        btn.disabled = true;

        // ì¶•í•˜ ì•Œë¦¼
        setTimeout(() => {
            alert("âœ¨ [System] ê³„ì•½ì´ ì²´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì´ˆê¸° ìê¸ˆ â‚©280,000,000 ì˜ ì—ë„ˆì§€ê°€\nê·€í•˜ì˜ ë¬´ì˜ì‹ ê³„ì¢Œ(Mental Bank)ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
            closeContract();
        }, 800);
    }
</script>
</body> </html>
